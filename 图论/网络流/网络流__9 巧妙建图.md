## 网络流__9 巧妙建图

> 猪 ：题目可抽象为`m`个点有对应的数值`mi`，有n个人取数，每次在能取的点中共取值最多`ki`的数，取完之后可以在能取到的点中重新分配每个点的权值。问最多能共取得多少值的数

由于存在时序性，因此需要考虑特殊的建图方式：

- 思路：建立源点S和汇点T，中间集合为来取数的人。对于每个点，从S向所有人中第一次来取这个点的人连一条容量为对应权值的边。如果当前人不是第一个来取这个点的值的人，为了体现时序性，记录每一个点上一次取数的人是谁，然后从上一次取此点的人向当前人连一条容量为正无穷的边。最后从所有人向汇点连一条容量为`此人取数值的上限`的边

```cpp
void solve(){
	rep(i,1,n){
		add(i,T,num[i]);
		rep(j,1,cnt[i]){
			int p = key[i][j];
			if(!last[p])
				add(S,i,pig[p]);
			else
				add(last[p],i,INF);
			last[p] = i;
		}
	}
	print(dinic());
}
int main(){
	memset(h,-1,sizeof h); memset(last,0,sizeof last);
	m=read(),n=read();S=0,T=n+1;
	rep(i,1,m) pig[i]=read();
	rep(i,1,n){
		cnt[i]=read();
		rep(j,1,cnt[i]) key[i][j]=read();
		num[i] = read();
	}
	solve();
	return 0;
}
```



### [网络流24题] 魔术球

> 有编号从1开始的不重复编号的小球若干。有n个柱子，向每根柱子上面放小球，只有编号加在一起为完全平方数的球才能放在一起。问n个柱子最多能放多少个球？并打印方案；n<=55

**分析：** 这道题的建图比较巧妙，首先建立源点和汇点，然后依次往里面增加小球和柱子，从源点向小球连容量为1的边，从柱子向汇点连容量为1的边；然后对于所有加过的编号，假如能和当前数组成完全平方数，就从该数向当前数连一条容量为1的边。然后接着跑最大流，每当最大流增加，说明有球可以节省柱子，能够放到其他球的上面，因此我们一直循环`小球数-累计最大流数<=n`，最终`小球数-1`即为答案。

找方案也很简单，沿着大于0的边走能够搜到的点说明应该放到当前柱子上

```cpp
// 找方案
void dfs(int u){
	printf("%d",u);
	for(int i=h[u];~i;i=ne[i]){
		int j=e[i];
		if(j == T||j<=2000) continue;
		if(!st[j-2000]&&!f[i]){
			st[j-2000]=true;
			printf(" ");
			dfs(j-2000); break;
		}
	}
}

void work(){
	int nt = 0;
	memset(st,0,sizeof st);
	rep(i,1,m){
		if(!st[i]){
			st[i] = true;
			dfs(i);
			puts("");
		}
	}
}
// 建图
while(m - cnt <= n){
        m ++ ;
        add(S,m,1); add(m+2000,T,1);
        rep(i,1,m-1) if(is_square(i+m)) add(i,2000+m,1);
        cnt += dinic();
}
```

### CQOI 危桥

> 给你n个岛屿以及相互之间的连接关系，`g[i][j]=O`表示`i`和`j`城市之间只能走2次，`X`表示`i`和`j`无法直接到达。`N`表示`i`和`j`之间可以通行任意多次。现在给出`n,a1,a2,an,b1,b2,bn`问是否可以达到：A从a1到a2走an次，B从b1到b2走bn次。

- 思路：

先按照给定的关系建边并且源点向a1连容量为an的边，a2向汇点连容量为an的边，源点向b1连容量为bn的边，b2向汇点连容量为bn的边。先跑一次最大流，如果满流，调换b1和b2，即建一个新图，然后源点向a1连容量为an的边，a2向汇点连容量为an的边，源点向b2连容量为bn的边，b1向汇点连容量为bn的边再跑一次最大流。如果两次都是满流则说明可以达到上述局面。

- 证明：

之后再补吧....s
